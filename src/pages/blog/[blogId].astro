---
import Layout from "../../layouts/Layout.astro";
type WatatakuBlog = {
  contents: Contents[];
};

type Contents = {
  id: string;
  createdAt: string;
  title: string;
  thumbnail: Thumbnail;
  body: string;
};

type Thumbnail = {
  url: string;
};

export async function getStaticPaths() {
  const myMicroCMSApiUrl = `https://du14ecbjft.microcms.io/api/v1/blog`;
  const res = await fetch(myMicroCMSApiUrl, {
    headers: {
      "X-MICROCMS-API-KEY": import.meta.env.MICROCMS_API_KEY,
    },
  });
  const getFetchData: WatatakuBlog = await res.json();

  return getFetchData.contents.map((contents: Contents) => ({
    params: {
      blogId: contents.id,
    },
  }));
}

//記事の詳細情報を取得
const { blogId } = Astro.params;
console.log(blogId);

const myMicroCMSApiUrl = `https://du14ecbjft.microcms.io/api/v1/blog/${blogId}`;
const res = await fetch(myMicroCMSApiUrl, {
  headers: {
    "X-MICROCMS-API-KEY": import.meta.env.MICROCMS_API_KEY,
  },
});
const getFetchBlogDetail: Contents = await res.json();
---

<Layout title={getFetchBlogDetail.title} description={getFetchBlogDetail.body}>
  <section class="blog">
    <img
      class="blog__thumbnail"
      src={getFetchBlogDetail.thumbnail.url}
      alt={getFetchBlogDetail.title}
    />
    <h1 class="blog__title">{getFetchBlogDetail.title}</h1>
    <div class="blog__post" set:html={getFetchBlogDetail.body}></div>
  </section>
</Layout>

<style>
  .blog {
    width: 90%;
    margin: 0 auto;
  }

  .blog__thumbnail {
    height: 300px;
    border: solid 1px black;
  }
</style>
